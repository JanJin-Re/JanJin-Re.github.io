<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สถานะห้องพักและราคา</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #F5DEB3;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        table {
            width: auto;
            border-collapse: collapse;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: white;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            text-align: center;
            vertical-align: middle;
            padding: 10px;
        }
        th {
            background-color: #8B4513;
            color: white;
            font-size: 18px;
        }
        td {
            font-size: 16px;
        }
        th:nth-child(1), td:nth-child(1) {
            width: 50px;
        }
        th:nth-child(2), td:nth-child(2) {
            width: 100px;
        }
        th:nth-child(3), td:nth-child(3) {
            width: 100px;
        }
        .available {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        .unavailable {
            background-color: #ffccbc;
            color: #d84315;
        }
        button {
            padding: 8px 12px;
            font-size: 16px;
            color: white;
            background-color: #8B4513;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background-color: #A0522D;
        }
        .admin-only {
            display: none;
        }
        .show-admin .admin-only {
            display: table-cell;
        }
        .toggle-btn {
            padding: 10px 20px;
            font-size: 18px;
            background-color: #8B4513;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 20px;
        }
        .toggle-btn:hover {
            background-color: #A0522D;
        }
        #loginModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        #loginModal.show {
            display: flex;
        }
        #loginForm {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #loginForm input {
            margin: 10px 0;
            padding: 10px;
            width: 90%;
            font-size: 16px;
            box-sizing: border-box;
        }
        #loginForm button {
            width: 100%;
            padding: 10px;
            background-color: #8B4513;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        #loginForm button:hover {
            background-color: #A0522D;
        }
        #cancelBtn {
            margin-top: 10px;
            background-color: #d32f2f;
        }
        #cancelBtn:hover {
            background-color: #b71c1c;
        }
    </style>
    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB9huDa17wQnpKFhYP8iGC35ivwlP-m_oU",
            authDomain: "example-7a9ac.firebaseapp.com",
            databaseURL: "https://example-7a9ac-default-rtdb.firebaseio.com",
            projectId: "example-7a9ac",
            storageBucket: "example-7a9ac.appspot.com",
            messagingSenderId: "470545773345",
            appId: "1:470545773345:web:9431f3d1192815dc1ec460"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        let isAdmin = false;

        // ฟังก์ชันเปิด modal ล็อกอิน
        function openLoginModal() {
            document.getElementById("loginModal").classList.add("show");
            document.getElementById("email").value = '';
            document.getElementById("password").value = '';
        }

        // ฟังก์ชันปิด modal ล็อกอิน
        function closeLoginModal() {
            document.getElementById("loginModal").classList.remove("show");
        }

        // ฟังก์ชันล็อกอิน
        function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            if (email === "admin@example.com" && password === "password123") {
                isAdmin = true;
                document.body.classList.add("show-admin");
                document.getElementById("adminToggleBtn").textContent = "ออกจากโหมดผู้ดูแล";
                closeLoginModal();
                loadRoomStatus(); // โหลดสถานะห้อง
            } else {
                alert("อีเมลหรือรหัสผ่านไม่ถูกต้อง");
            }
        }

        // ฟังก์ชันเปิด/ปิดโหมดผู้ดูแล
        function toggleAdminMode() {
            if (isAdmin) {
                saveRoomStatus(); // บันทึกสถานะห้องก่อนออกจากโหมดผู้ดูแล
                isAdmin = false;
                document.body.classList.remove("show-admin");
                document.getElementById("adminToggleBtn").textContent = "เข้าสู่โหมดผู้ดูแล";
            } else {
                openLoginModal();
            }
        }

        // ฟังก์ชันสำหรับอัพเดทสถานะห้อง
        function updateStatus(button) {
            const row = button.closest('tr');
            const statusCell = row.querySelector('.status');
            if (statusCell.classList.contains('available')) {
                statusCell.textContent = 'ไม่ว่าง';
                statusCell.classList.remove('available');
                statusCell.classList.add('unavailable');
            } else {
                statusCell.textContent = 'ว่าง';
                statusCell.classList.remove('unavailable');
                statusCell.classList.add('available');
            }
            saveRoomStatus(); // บันทึกสถานะหลังการอัพเดท
        }

        // ฟังก์ชันบันทึกสถานะห้อง
        function saveRoomStatus() {
            const roomData = [];
            const rows = document.querySelectorAll("#room-status tr");
            rows.forEach(row => {
                const roomNumber = row.querySelector('td:first-child').textContent;
                const status = row.querySelector('.status').textContent;
                const price = row.querySelector('td:nth-child(3)').textContent;
                roomData.push({ roomNumber, status, price });
            });

            // บันทึกข้อมูลลง Firebase
            roomData.forEach(room => {
                set(ref(db, 'rooms/' + room.roomNumber), { status: room.status, price: room.price });
            });
        }

        // ฟังก์ชันโหลดสถานะห้อง
        function loadRoomStatus() {
            const roomsRef = ref(db, 'rooms/');
            onValue(roomsRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const rows = document.querySelectorAll("#room-status tr");
                    rows.forEach(row => {
                        const roomNumber = row.dataset.room;
                        const room = data[roomNumber];
                        if (room) {
                            const statusCell = row.querySelector('.status');
                            statusCell.textContent = room.status;
                            statusCell.className = room.status === 'ว่าง' ? 'status available' : 'status unavailable';
                            const priceCell = row.querySelector('td:nth-child(3)');
                            priceCell.textContent = room.price;
                        }
                    });
                }
            });
        }

        // เรียกใช้งานเมื่อโหลดหน้า
        document.addEventListener("DOMContentLoaded", loadRoomStatus);
    </script>
</head>
<body>
    <h1>สถานะห้องพัก</h1>
    <button id="adminToggleBtn" class="toggle-btn" onclick="toggleAdminMode()">เข้าสู่โหมดผู้ดูแล</button>
    
    <table id="room-status">
        <thead>
            <tr>
                <th>หมายเลขห้อง</th>
                <th>สถานะ</th>
                <th>ราคา</th>
                <th class="admin-only">อัพเดตสถานะ</th>
            </tr>
        </thead>
        <tbody>
            <tr data-room="101">
                <td>101</td>
                <td class="status available">ว่าง</td>
                <td>1000</td>
                <td class="admin-only"><button onclick="updateStatus(this)">เปลี่ยนสถานะ</button></td>
            </tr>
            <tr data-room="102">
                <td>102</td>
                <td class="status unavailable">ไม่ว่าง</td>
                <td>1200</td>
                <td class="admin-only"><button onclick="updateStatus(this)">เปลี่ยนสถานะ</button></td>
            </tr>
            <tr data-room="103">
                <td>103</td>
                <td class="status available">ว่าง</td>
                <td>900</td>
                <td class="admin-only"><button onclick="updateStatus(this)">เปลี่ยนสถานะ</button></td>
            </tr>
        </tbody>
    </table>

    <div id="loginModal">
        <div id="loginForm">
            <h2>เข้าสู่ระบบผู้ดูแล</h2>
            <input type="text" id="email" placeholder="อีเมล" required>
            <input type="password" id="password" placeholder="รหัสผ่าน" required>
            <button onclick="login()">เข้าสู่ระบบ</button>
            <button id="cancelBtn" onclick="closeLoginModal()">ยกเลิก</button>
        </div>
    </div>
</body>
</html>
