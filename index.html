<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สถานะห้องพักและราคา</title>
    <style>
        /* (styles ของคุณที่มีอยู่) */
    </style>
    <!-- Import Firebase App -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB9huDa17wQnpKFhYP8iGC35ivwlP-m_oU",
            authDomain: "example-7a9ac.firebaseapp.com",
            databaseURL: "https://example-7a9ac-default-rtdb.firebaseio.com",
            projectId: "example-7a9ac",
            storageBucket: "example-7a9ac.appspot.com",
            messagingSenderId: "470545773345",
            appId: "1:470545773345:web:9431f3d1192815dc1ec460"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ฟังก์ชันบันทึกสถานะห้อง
        function saveRoomStatus() {
            const roomData = [];
            const rows = document.querySelectorAll("#room-status tr");
            rows.forEach(row => {
                const roomNumber = row.querySelector('td:first-child').textContent;
                const status = row.querySelector('.status').textContent;
                const price = row.querySelector('td:nth-child(3)').textContent;
                roomData.push({ roomNumber, status, price });
            });

            // บันทึกข้อมูลลง Firebase
            roomData.forEach(room => {
                set(ref(db, 'rooms/' + room.roomNumber), {
                    status: room.status,
                    price: room.price
                });
            });
        }

        // ฟังก์ชันโหลดสถานะห้อง
        function loadRoomStatus() {
            const starCountRef = ref(db, 'rooms/');
            onValue(starCountRef, (snapshot) => {
                const roomData = snapshot.val();
                if (roomData) {
                    for (let room in roomData) {
                        const row = document.querySelectorAll("#room-status tr")[room - 1];
                        const statusCell = row.querySelector('.status');
                        statusCell.textContent = roomData[room].status;
                        statusCell.className = roomData[room].status === 'ว่าง' ? 'status available' : 'status unavailable';
                        row.querySelector('td:nth-child(3)').textContent = roomData[room].price;
                    }
                }
            });
        }

        // โหลดสถานะห้องเมื่อหน้าเว็บถูกโหลด
        window.onload = loadRoomStatus;

        // ฟังก์ชันสำหรับการเข้าสู่โหมดผู้ดูแล
        window.toggleAdminMode = function() {
            if (isAdmin) {
                saveRoomStatus();
                isAdmin = false;
                document.body.classList.remove("show-admin");
                document.getElementById("adminToggleBtn").textContent = "เข้าสู่โหมดผู้ดูแล";
            } else {
                openLoginModal();
            }
        };
    </script>
</head>
<body>

<h1>สถานะห้องพักและราคา</h1>

<button id="adminToggleBtn" class="toggle-btn" onclick="toggleAdminMode()">เข้าสู่โหมดผู้ดูแล</button>

<table>
    <thead>
        <tr>
            <th>ห้อง</th>
            <th>สถานะ</th>
            <th>ราคา (บาท/คืน)</th>
            <th class="admin-only">อัพเดทสถานะ</th>
        </tr>
    </thead>
    <tbody id="room-status">
        <tr>
            <td>1</td>
            <td class="status available">ว่าง</td>
            <td>500</td>
            <td class="admin-only"><button onclick="updateStatus(this)">อัพเดท</button></td>
        </tr>
        <!-- (ข้อมูลห้องพักอื่น ๆ) -->
    </tbody>
</table>

<div id="loginModal">
    <div id="loginForm">
        <h2>เข้าสู่ระบบผู้ดูแล</h2>
        <input type="email" id="email" placeholder="อีเมล" required>
        <input type="password" id="password" placeholder="รหัสผ่าน" required>
        <button onclick="login()">เข้าสู่ระบบ</button>
        <button id="cancelBtn" onclick="closeLoginModal()">ยกเลิก</button>
    </div>
</div>

<script>
    const correctEmail = "admin@example.com";
    const correctPassword = "password123";
    let isAdmin = false;

    // ฟังก์ชันเปิด modal ล็อกอิน
    function openLoginModal() {
        document.getElementById("loginModal").classList.add("show");
        document.getElementById("email").value = '';
        document.getElementById("password").value = '';
    }

    // ฟังก์ชันปิด modal ล็อกอิน
    function closeLoginModal() {
        document.getElementById("loginModal").classList.remove("show");
    }

    // ฟังก์ชันล็อกอิน
    function login() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        if (email === correctEmail && password === correctPassword) {
            isAdmin = true;
            document.body.classList.add("show-admin");
            document.getElementById("adminToggleBtn").textContent = "ออกจากโหมดผู้ดูแล";
            closeLoginModal();
            loadRoomStatus(); // โหลดสถานะห้อง
        } else {
            alert("อีเมลหรือรหัสผ่านไม่ถูกต้อง");
        }
    }
</script>

</body>
</html>
